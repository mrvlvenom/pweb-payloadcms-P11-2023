"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateVersion", {
    enumerable: true,
    get: function() {
        return updateVersion;
    }
});
const _withSession = require("./withSession");
const updateVersion = async function updateVersion({ collection, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[collection];
    const options = {
        ...(0, _withSession.withSession)(this, req.transactionID),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where
    });
    const doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    const result = JSON.parse(JSON.stringify(doc));
    const verificationToken = doc._verificationToken;
    // custom id type reset
    result.id = result._id;
    if (verificationToken) {
        result._verificationToken = verificationToken;
    }
    return result;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlVmVyc2lvbiB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBNb25nb29zZUFkYXB0ZXIgfSBmcm9tICcuJ1xuXG5pbXBvcnQgeyB3aXRoU2Vzc2lvbiB9IGZyb20gJy4vd2l0aFNlc3Npb24nXG5cbmV4cG9ydCBjb25zdCB1cGRhdGVWZXJzaW9uOiBVcGRhdGVWZXJzaW9uID0gYXN5bmMgZnVuY3Rpb24gdXBkYXRlVmVyc2lvbihcbiAgdGhpczogTW9uZ29vc2VBZGFwdGVyLFxuICB7IGNvbGxlY3Rpb24sIGxvY2FsZSwgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QsIHZlcnNpb25EYXRhLCB3aGVyZSB9LFxuKSB7XG4gIGNvbnN0IFZlcnNpb25Nb2RlbCA9IHRoaXMudmVyc2lvbnNbY29sbGVjdGlvbl1cbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAuLi53aXRoU2Vzc2lvbih0aGlzLCByZXEudHJhbnNhY3Rpb25JRCksXG4gICAgbGVhbjogdHJ1ZSxcbiAgICBuZXc6IHRydWUsXG4gIH1cblxuICBjb25zdCBxdWVyeSA9IGF3YWl0IFZlcnNpb25Nb2RlbC5idWlsZFF1ZXJ5KHtcbiAgICBsb2NhbGUsXG4gICAgcGF5bG9hZDogdGhpcy5wYXlsb2FkLFxuICAgIHdoZXJlLFxuICB9KVxuXG4gIGNvbnN0IGRvYyA9IGF3YWl0IFZlcnNpb25Nb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCB2ZXJzaW9uRGF0YSwgb3B0aW9ucylcblxuICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRvYykpXG5cbiAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBkb2MuX3ZlcmlmaWNhdGlvblRva2VuXG5cbiAgLy8gY3VzdG9tIGlkIHR5cGUgcmVzZXRcbiAgcmVzdWx0LmlkID0gcmVzdWx0Ll9pZFxuICBpZiAodmVyaWZpY2F0aW9uVG9rZW4pIHtcbiAgICByZXN1bHQuX3ZlcmlmaWNhdGlvblRva2VuID0gdmVyaWZpY2F0aW9uVG9rZW5cbiAgfVxuICByZXR1cm4gcmVzdWx0XG59XG4iXSwibmFtZXMiOlsidXBkYXRlVmVyc2lvbiIsImNvbGxlY3Rpb24iLCJsb2NhbGUiLCJyZXEiLCJ2ZXJzaW9uRGF0YSIsIndoZXJlIiwiVmVyc2lvbk1vZGVsIiwidmVyc2lvbnMiLCJvcHRpb25zIiwid2l0aFNlc3Npb24iLCJ0cmFuc2FjdGlvbklEIiwibGVhbiIsIm5ldyIsInF1ZXJ5IiwiYnVpbGRRdWVyeSIsInBheWxvYWQiLCJkb2MiLCJmaW5kT25lQW5kVXBkYXRlIiwicmVzdWx0IiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwidmVyaWZpY2F0aW9uVG9rZW4iLCJfdmVyaWZpY2F0aW9uVG9rZW4iLCJpZCIsIl9pZCJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFPYUE7OztlQUFBQTs7OzZCQUZlO0FBRXJCLE1BQU1BLGdCQUErQixlQUFlQSxjQUV6RCxFQUFFQyxVQUFVLEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxDQUFDLENBQW1CLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFO0lBRXRFLE1BQU1DLGVBQWUsSUFBSSxDQUFDQyxRQUFRLENBQUNOLFdBQVc7SUFDOUMsTUFBTU8sVUFBVTtRQUNkLEdBQUdDLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFTixJQUFJTyxhQUFhLENBQUM7UUFDdkNDLE1BQU07UUFDTkMsS0FBSztJQUNQO0lBRUEsTUFBTUMsUUFBUSxNQUFNUCxhQUFhUSxVQUFVLENBQUM7UUFDMUNaO1FBQ0FhLFNBQVMsSUFBSSxDQUFDQSxPQUFPO1FBQ3JCVjtJQUNGO0lBRUEsTUFBTVcsTUFBTSxNQUFNVixhQUFhVyxnQkFBZ0IsQ0FBQ0osT0FBT1QsYUFBYUk7SUFFcEUsTUFBTVUsU0FBU0MsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNMO0lBRXpDLE1BQU1NLG9CQUFvQk4sSUFBSU8sa0JBQWtCO0lBRWhELHVCQUF1QjtJQUN2QkwsT0FBT00sRUFBRSxHQUFHTixPQUFPTyxHQUFHO0lBQ3RCLElBQUlILG1CQUFtQjtRQUNyQkosT0FBT0ssa0JBQWtCLEdBQUdEO0lBQzlCO0lBQ0EsT0FBT0o7QUFDVCJ9