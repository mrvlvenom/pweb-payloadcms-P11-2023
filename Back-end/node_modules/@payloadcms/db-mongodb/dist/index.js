"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "mongooseAdapter", {
    enumerable: true,
    get: function() {
        return mongooseAdapter;
    }
});
const _mongoose = /*#__PURE__*/ _interop_require_default(require("mongoose"));
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
const _database = require("payload/database");
const _connect = require("./connect");
const _create = require("./create");
const _createGlobal = require("./createGlobal");
const _createGlobalVersion = require("./createGlobalVersion");
const _createMigration = require("./createMigration");
const _createVersion = require("./createVersion");
const _deleteMany = require("./deleteMany");
const _deleteOne = require("./deleteOne");
const _deleteVersions = require("./deleteVersions");
const _destroy = require("./destroy");
const _extendViteConfig = require("./extendViteConfig");
const _extendWebpackConfig = require("./extendWebpackConfig");
const _find = require("./find");
const _findGlobal = require("./findGlobal");
const _findGlobalVersions = require("./findGlobalVersions");
const _findOne = require("./findOne");
const _findVersions = require("./findVersions");
const _init = require("./init");
const _migrateFresh = require("./migrateFresh");
const _queryDrafts = require("./queryDrafts");
const _beginTransaction = require("./transactions/beginTransaction");
const _commitTransaction = require("./transactions/commitTransaction");
const _rollbackTransaction = require("./transactions/rollbackTransaction");
const _updateGlobal = require("./updateGlobal");
const _updateGlobalVersion = require("./updateGlobalVersion");
const _updateOne = require("./updateOne");
const _updateVersion = require("./updateVersion");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function mongooseAdapter({ autoPluralization = true, connectOptions, migrationDir: migrationDirArg, url }) {
    function adapter({ payload }) {
        const migrationDir = migrationDirArg || _path.default.resolve(process.cwd(), 'src/migrations');
        _mongoose.default.set('strictQuery', false);
        (0, _extendWebpackConfig.extendWebpackConfig)(payload.config);
        (0, _extendViteConfig.extendViteConfig)(payload.config);
        return (0, _database.createDatabaseAdapter)({
            name: 'mongoose',
            // Mongoose-specific
            autoPluralization,
            collections: {},
            connectOptions: connectOptions || {},
            connection: undefined,
            globals: undefined,
            mongoMemoryServer: undefined,
            sessions: {},
            url,
            versions: {},
            // DatabaseAdapter
            beginTransaction: _beginTransaction.beginTransaction,
            commitTransaction: _commitTransaction.commitTransaction,
            connect: _connect.connect,
            create: _create.create,
            createGlobal: _createGlobal.createGlobal,
            createGlobalVersion: _createGlobalVersion.createGlobalVersion,
            createMigration: _createMigration.createMigration,
            createVersion: _createVersion.createVersion,
            defaultIDType: 'text',
            deleteMany: _deleteMany.deleteMany,
            deleteOne: _deleteOne.deleteOne,
            deleteVersions: _deleteVersions.deleteVersions,
            destroy: _destroy.destroy,
            find: _find.find,
            findGlobal: _findGlobal.findGlobal,
            findGlobalVersions: _findGlobalVersions.findGlobalVersions,
            findOne: _findOne.findOne,
            findVersions: _findVersions.findVersions,
            init: _init.init,
            migrateFresh: _migrateFresh.migrateFresh,
            migrationDir,
            payload,
            queryDrafts: _queryDrafts.queryDrafts,
            rollbackTransaction: _rollbackTransaction.rollbackTransaction,
            updateGlobal: _updateGlobal.updateGlobal,
            updateGlobalVersion: _updateGlobalVersion.updateGlobalVersion,
            updateOne: _updateOne.updateOne,
            updateVersion: _updateVersion.updateVersion
        });
    }
    return adapter;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENsaWVudFNlc3Npb24sIENvbm5lY3RPcHRpb25zLCBDb25uZWN0aW9uIH0gZnJvbSAnbW9uZ29vc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWQgfSBmcm9tICdwYXlsb2FkJ1xuaW1wb3J0IHR5cGUgeyBCYXNlRGF0YWJhc2VBZGFwdGVyIH0gZnJvbSAncGF5bG9hZC9kYXRhYmFzZSdcblxuaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IGNyZWF0ZURhdGFiYXNlQWRhcHRlciB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5cbmV4cG9ydCB0eXBlIHsgTWlncmF0ZURvd25BcmdzLCBNaWdyYXRlVXBBcmdzIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBDb2xsZWN0aW9uTW9kZWwsIEdsb2JhbE1vZGVsIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJy4vY29ubmVjdCdcbmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJy4vY3JlYXRlJ1xuaW1wb3J0IHsgY3JlYXRlR2xvYmFsIH0gZnJvbSAnLi9jcmVhdGVHbG9iYWwnXG5pbXBvcnQgeyBjcmVhdGVHbG9iYWxWZXJzaW9uIH0gZnJvbSAnLi9jcmVhdGVHbG9iYWxWZXJzaW9uJ1xuaW1wb3J0IHsgY3JlYXRlTWlncmF0aW9uIH0gZnJvbSAnLi9jcmVhdGVNaWdyYXRpb24nXG5pbXBvcnQgeyBjcmVhdGVWZXJzaW9uIH0gZnJvbSAnLi9jcmVhdGVWZXJzaW9uJ1xuaW1wb3J0IHsgZGVsZXRlTWFueSB9IGZyb20gJy4vZGVsZXRlTWFueSdcbmltcG9ydCB7IGRlbGV0ZU9uZSB9IGZyb20gJy4vZGVsZXRlT25lJ1xuaW1wb3J0IHsgZGVsZXRlVmVyc2lvbnMgfSBmcm9tICcuL2RlbGV0ZVZlcnNpb25zJ1xuaW1wb3J0IHsgZGVzdHJveSB9IGZyb20gJy4vZGVzdHJveSdcbmltcG9ydCB7IGV4dGVuZFZpdGVDb25maWcgfSBmcm9tICcuL2V4dGVuZFZpdGVDb25maWcnXG5pbXBvcnQgeyBleHRlbmRXZWJwYWNrQ29uZmlnIH0gZnJvbSAnLi9leHRlbmRXZWJwYWNrQ29uZmlnJ1xuaW1wb3J0IHsgZmluZCB9IGZyb20gJy4vZmluZCdcbmltcG9ydCB7IGZpbmRHbG9iYWwgfSBmcm9tICcuL2ZpbmRHbG9iYWwnXG5pbXBvcnQgeyBmaW5kR2xvYmFsVmVyc2lvbnMgfSBmcm9tICcuL2ZpbmRHbG9iYWxWZXJzaW9ucydcbmltcG9ydCB7IGZpbmRPbmUgfSBmcm9tICcuL2ZpbmRPbmUnXG5pbXBvcnQgeyBmaW5kVmVyc2lvbnMgfSBmcm9tICcuL2ZpbmRWZXJzaW9ucydcbmltcG9ydCB7IGluaXQgfSBmcm9tICcuL2luaXQnXG5pbXBvcnQgeyBtaWdyYXRlRnJlc2ggfSBmcm9tICcuL21pZ3JhdGVGcmVzaCdcbmltcG9ydCB7IHF1ZXJ5RHJhZnRzIH0gZnJvbSAnLi9xdWVyeURyYWZ0cydcbmltcG9ydCB7IGJlZ2luVHJhbnNhY3Rpb24gfSBmcm9tICcuL3RyYW5zYWN0aW9ucy9iZWdpblRyYW5zYWN0aW9uJ1xuaW1wb3J0IHsgY29tbWl0VHJhbnNhY3Rpb24gfSBmcm9tICcuL3RyYW5zYWN0aW9ucy9jb21taXRUcmFuc2FjdGlvbidcbmltcG9ydCB7IHJvbGxiYWNrVHJhbnNhY3Rpb24gfSBmcm9tICcuL3RyYW5zYWN0aW9ucy9yb2xsYmFja1RyYW5zYWN0aW9uJ1xuaW1wb3J0IHsgdXBkYXRlR2xvYmFsIH0gZnJvbSAnLi91cGRhdGVHbG9iYWwnXG5pbXBvcnQgeyB1cGRhdGVHbG9iYWxWZXJzaW9uIH0gZnJvbSAnLi91cGRhdGVHbG9iYWxWZXJzaW9uJ1xuaW1wb3J0IHsgdXBkYXRlT25lIH0gZnJvbSAnLi91cGRhdGVPbmUnXG5pbXBvcnQgeyB1cGRhdGVWZXJzaW9uIH0gZnJvbSAnLi91cGRhdGVWZXJzaW9uJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEFyZ3Mge1xuICAvKiogU2V0IHRvIGZhbHNlIHRvIGRpc2FibGUgYXV0by1wbHVyYWxpemF0aW9uIG9mIGNvbGxlY3Rpb24gbmFtZXMsIERlZmF1bHRzIHRvIHRydWUgKi9cbiAgYXV0b1BsdXJhbGl6YXRpb24/OiBib29sZWFuXG4gIC8qKiBFeHRyYSBjb25maWd1cmF0aW9uIG9wdGlvbnMgKi9cbiAgY29ubmVjdE9wdGlvbnM/OiBDb25uZWN0T3B0aW9ucyAmIHtcbiAgICAvKiogU2V0IGZhbHNlIHRvIGRpc2FibGUgJGZhY2V0IGFnZ3JlZ2F0aW9uIGluIG5vbi1zdXBwb3J0aW5nIGRhdGFiYXNlcywgRGVmYXVsdHMgdG8gdHJ1ZSAqL1xuICAgIHVzZUZhY2V0PzogYm9vbGVhblxuICB9XG4gIG1pZ3JhdGlvbkRpcj86IHN0cmluZ1xuICAvKiogVGhlIFVSTCB0byBjb25uZWN0IHRvIE1vbmdvREIgb3IgZmFsc2UgdG8gc3RhcnQgcGF5bG9hZCBhbmQgcHJldmVudCBjb25uZWN0aW5nICovXG4gIHVybDogZmFsc2UgfCBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgTW9uZ29vc2VBZGFwdGVyID0gQmFzZURhdGFiYXNlQWRhcHRlciAmXG4gIEFyZ3MgJiB7XG4gICAgY29sbGVjdGlvbnM6IHtcbiAgICAgIFtzbHVnOiBzdHJpbmddOiBDb2xsZWN0aW9uTW9kZWxcbiAgICB9XG4gICAgY29ubmVjdGlvbjogQ29ubmVjdGlvblxuICAgIGdsb2JhbHM6IEdsb2JhbE1vZGVsXG4gICAgbW9uZ29NZW1vcnlTZXJ2ZXI6IGFueVxuICAgIHNlc3Npb25zOiBSZWNvcmQ8bnVtYmVyIHwgc3RyaW5nLCBDbGllbnRTZXNzaW9uPlxuICAgIHZlcnNpb25zOiB7XG4gICAgICBbc2x1Zzogc3RyaW5nXTogQ29sbGVjdGlvbk1vZGVsXG4gICAgfVxuICB9XG5cbnR5cGUgTW9uZ29vc2VBZGFwdGVyUmVzdWx0ID0gKGFyZ3M6IHsgcGF5bG9hZDogUGF5bG9hZCB9KSA9PiBNb25nb29zZUFkYXB0ZXJcblxuZGVjbGFyZSBtb2R1bGUgJ3BheWxvYWQnIHtcbiAgZXhwb3J0IGludGVyZmFjZSBEYXRhYmFzZUFkYXB0ZXJcbiAgICBleHRlbmRzIE9taXQ8QmFzZURhdGFiYXNlQWRhcHRlciwgJ3Nlc3Npb25zJz4sXG4gICAgICBPbWl0PEFyZ3MsICdtaWdyYXRpb25EaXInPiB7XG4gICAgY29sbGVjdGlvbnM6IHtcbiAgICAgIFtzbHVnOiBzdHJpbmddOiBDb2xsZWN0aW9uTW9kZWxcbiAgICB9XG4gICAgY29ubmVjdGlvbjogQ29ubmVjdGlvblxuICAgIGdsb2JhbHM6IEdsb2JhbE1vZGVsXG4gICAgbW9uZ29NZW1vcnlTZXJ2ZXI6IGFueVxuICAgIHNlc3Npb25zOiBSZWNvcmQ8bnVtYmVyIHwgc3RyaW5nLCBDbGllbnRTZXNzaW9uPlxuICAgIHZlcnNpb25zOiB7XG4gICAgICBbc2x1Zzogc3RyaW5nXTogQ29sbGVjdGlvbk1vZGVsXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtb25nb29zZUFkYXB0ZXIoe1xuICBhdXRvUGx1cmFsaXphdGlvbiA9IHRydWUsXG4gIGNvbm5lY3RPcHRpb25zLFxuICBtaWdyYXRpb25EaXI6IG1pZ3JhdGlvbkRpckFyZyxcbiAgdXJsLFxufTogQXJncyk6IE1vbmdvb3NlQWRhcHRlclJlc3VsdCB7XG4gIGZ1bmN0aW9uIGFkYXB0ZXIoeyBwYXlsb2FkIH06IHsgcGF5bG9hZDogUGF5bG9hZCB9KSB7XG4gICAgY29uc3QgbWlncmF0aW9uRGlyID0gbWlncmF0aW9uRGlyQXJnIHx8IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCAnc3JjL21pZ3JhdGlvbnMnKVxuICAgIG1vbmdvb3NlLnNldCgnc3RyaWN0UXVlcnknLCBmYWxzZSlcblxuICAgIGV4dGVuZFdlYnBhY2tDb25maWcocGF5bG9hZC5jb25maWcpXG4gICAgZXh0ZW5kVml0ZUNvbmZpZyhwYXlsb2FkLmNvbmZpZylcblxuICAgIHJldHVybiBjcmVhdGVEYXRhYmFzZUFkYXB0ZXI8TW9uZ29vc2VBZGFwdGVyPih7XG4gICAgICBuYW1lOiAnbW9uZ29vc2UnLFxuXG4gICAgICAvLyBNb25nb29zZS1zcGVjaWZpY1xuICAgICAgYXV0b1BsdXJhbGl6YXRpb24sXG4gICAgICBjb2xsZWN0aW9uczoge30sXG4gICAgICBjb25uZWN0T3B0aW9uczogY29ubmVjdE9wdGlvbnMgfHwge30sXG4gICAgICBjb25uZWN0aW9uOiB1bmRlZmluZWQsXG4gICAgICBnbG9iYWxzOiB1bmRlZmluZWQsXG4gICAgICBtb25nb01lbW9yeVNlcnZlcjogdW5kZWZpbmVkLFxuICAgICAgc2Vzc2lvbnM6IHt9LFxuICAgICAgdXJsLFxuICAgICAgdmVyc2lvbnM6IHt9LFxuXG4gICAgICAvLyBEYXRhYmFzZUFkYXB0ZXJcbiAgICAgIGJlZ2luVHJhbnNhY3Rpb24sXG4gICAgICBjb21taXRUcmFuc2FjdGlvbixcbiAgICAgIGNvbm5lY3QsXG4gICAgICBjcmVhdGUsXG4gICAgICBjcmVhdGVHbG9iYWwsXG4gICAgICBjcmVhdGVHbG9iYWxWZXJzaW9uLFxuICAgICAgY3JlYXRlTWlncmF0aW9uLFxuICAgICAgY3JlYXRlVmVyc2lvbixcbiAgICAgIGRlZmF1bHRJRFR5cGU6ICd0ZXh0JyxcbiAgICAgIGRlbGV0ZU1hbnksXG4gICAgICBkZWxldGVPbmUsXG4gICAgICBkZWxldGVWZXJzaW9ucyxcbiAgICAgIGRlc3Ryb3ksXG4gICAgICBmaW5kLFxuICAgICAgZmluZEdsb2JhbCxcbiAgICAgIGZpbmRHbG9iYWxWZXJzaW9ucyxcbiAgICAgIGZpbmRPbmUsXG4gICAgICBmaW5kVmVyc2lvbnMsXG4gICAgICBpbml0LFxuICAgICAgbWlncmF0ZUZyZXNoLFxuICAgICAgbWlncmF0aW9uRGlyLFxuICAgICAgcGF5bG9hZCxcbiAgICAgIHF1ZXJ5RHJhZnRzLFxuICAgICAgcm9sbGJhY2tUcmFuc2FjdGlvbixcbiAgICAgIHVwZGF0ZUdsb2JhbCxcbiAgICAgIHVwZGF0ZUdsb2JhbFZlcnNpb24sXG4gICAgICB1cGRhdGVPbmUsXG4gICAgICB1cGRhdGVWZXJzaW9uLFxuICAgIH0pXG4gIH1cblxuICByZXR1cm4gYWRhcHRlclxufVxuIl0sIm5hbWVzIjpbIm1vbmdvb3NlQWRhcHRlciIsImF1dG9QbHVyYWxpemF0aW9uIiwiY29ubmVjdE9wdGlvbnMiLCJtaWdyYXRpb25EaXIiLCJtaWdyYXRpb25EaXJBcmciLCJ1cmwiLCJhZGFwdGVyIiwicGF5bG9hZCIsInBhdGgiLCJyZXNvbHZlIiwicHJvY2VzcyIsImN3ZCIsIm1vbmdvb3NlIiwic2V0IiwiZXh0ZW5kV2VicGFja0NvbmZpZyIsImNvbmZpZyIsImV4dGVuZFZpdGVDb25maWciLCJjcmVhdGVEYXRhYmFzZUFkYXB0ZXIiLCJuYW1lIiwiY29sbGVjdGlvbnMiLCJjb25uZWN0aW9uIiwidW5kZWZpbmVkIiwiZ2xvYmFscyIsIm1vbmdvTWVtb3J5U2VydmVyIiwic2Vzc2lvbnMiLCJ2ZXJzaW9ucyIsImJlZ2luVHJhbnNhY3Rpb24iLCJjb21taXRUcmFuc2FjdGlvbiIsImNvbm5lY3QiLCJjcmVhdGUiLCJjcmVhdGVHbG9iYWwiLCJjcmVhdGVHbG9iYWxWZXJzaW9uIiwiY3JlYXRlTWlncmF0aW9uIiwiY3JlYXRlVmVyc2lvbiIsImRlZmF1bHRJRFR5cGUiLCJkZWxldGVNYW55IiwiZGVsZXRlT25lIiwiZGVsZXRlVmVyc2lvbnMiLCJkZXN0cm95IiwiZmluZCIsImZpbmRHbG9iYWwiLCJmaW5kR2xvYmFsVmVyc2lvbnMiLCJmaW5kT25lIiwiZmluZFZlcnNpb25zIiwiaW5pdCIsIm1pZ3JhdGVGcmVzaCIsInF1ZXJ5RHJhZnRzIiwicm9sbGJhY2tUcmFuc2FjdGlvbiIsInVwZGF0ZUdsb2JhbCIsInVwZGF0ZUdsb2JhbFZlcnNpb24iLCJ1cGRhdGVPbmUiLCJ1cGRhdGVWZXJzaW9uIl0sIm1hcHBpbmdzIjoiOzs7OytCQXNGZ0JBOzs7ZUFBQUE7OztpRUFsRks7NkRBQ0o7MEJBQ3FCO3lCQU1kO3dCQUNEOzhCQUNNO3FDQUNPO2lDQUNKOytCQUNGOzRCQUNIOzJCQUNEO2dDQUNLO3lCQUNQO2tDQUNTO3FDQUNHO3NCQUNmOzRCQUNNO29DQUNRO3lCQUNYOzhCQUNLO3NCQUNSOzhCQUNROzZCQUNEO2tDQUNLO21DQUNDO3FDQUNFOzhCQUNQO3FDQUNPOzJCQUNWOytCQUNJOzs7Ozs7QUFnRHZCLFNBQVNBLGdCQUFnQixFQUM5QkMsb0JBQW9CLElBQUksRUFDeEJDLGNBQWMsRUFDZEMsY0FBY0MsZUFBZSxFQUM3QkMsR0FBRyxFQUNFO0lBQ0wsU0FBU0MsUUFBUSxFQUFFQyxPQUFPLEVBQXdCO1FBQ2hELE1BQU1KLGVBQWVDLG1CQUFtQkksYUFBSSxDQUFDQyxPQUFPLENBQUNDLFFBQVFDLEdBQUcsSUFBSTtRQUNwRUMsaUJBQVEsQ0FBQ0MsR0FBRyxDQUFDLGVBQWU7UUFFNUJDLElBQUFBLHdDQUFtQixFQUFDUCxRQUFRUSxNQUFNO1FBQ2xDQyxJQUFBQSxrQ0FBZ0IsRUFBQ1QsUUFBUVEsTUFBTTtRQUUvQixPQUFPRSxJQUFBQSwrQkFBcUIsRUFBa0I7WUFDNUNDLE1BQU07WUFFTixvQkFBb0I7WUFDcEJqQjtZQUNBa0IsYUFBYSxDQUFDO1lBQ2RqQixnQkFBZ0JBLGtCQUFrQixDQUFDO1lBQ25Da0IsWUFBWUM7WUFDWkMsU0FBU0Q7WUFDVEUsbUJBQW1CRjtZQUNuQkcsVUFBVSxDQUFDO1lBQ1huQjtZQUNBb0IsVUFBVSxDQUFDO1lBRVgsa0JBQWtCO1lBQ2xCQyxrQkFBQUEsa0NBQWdCO1lBQ2hCQyxtQkFBQUEsb0NBQWlCO1lBQ2pCQyxTQUFBQSxnQkFBTztZQUNQQyxRQUFBQSxjQUFNO1lBQ05DLGNBQUFBLDBCQUFZO1lBQ1pDLHFCQUFBQSx3Q0FBbUI7WUFDbkJDLGlCQUFBQSxnQ0FBZTtZQUNmQyxlQUFBQSw0QkFBYTtZQUNiQyxlQUFlO1lBQ2ZDLFlBQUFBLHNCQUFVO1lBQ1ZDLFdBQUFBLG9CQUFTO1lBQ1RDLGdCQUFBQSw4QkFBYztZQUNkQyxTQUFBQSxnQkFBTztZQUNQQyxNQUFBQSxVQUFJO1lBQ0pDLFlBQUFBLHNCQUFVO1lBQ1ZDLG9CQUFBQSxzQ0FBa0I7WUFDbEJDLFNBQUFBLGdCQUFPO1lBQ1BDLGNBQUFBLDBCQUFZO1lBQ1pDLE1BQUFBLFVBQUk7WUFDSkMsY0FBQUEsMEJBQVk7WUFDWjFDO1lBQ0FJO1lBQ0F1QyxhQUFBQSx3QkFBVztZQUNYQyxxQkFBQUEsd0NBQW1CO1lBQ25CQyxjQUFBQSwwQkFBWTtZQUNaQyxxQkFBQUEsd0NBQW1CO1lBQ25CQyxXQUFBQSxvQkFBUztZQUNUQyxlQUFBQSw0QkFBYTtRQUNmO0lBQ0Y7SUFFQSxPQUFPN0M7QUFDVCJ9