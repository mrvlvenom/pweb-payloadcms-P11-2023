"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateGlobalVersion", {
    enumerable: true,
    get: function() {
        return updateGlobalVersion;
    }
});
const _withSession = require("./withSession");
async function updateGlobalVersion({ global, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[global];
    const options = {
        ...(0, _withSession.withSession)(this, req.transactionID),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where
    });
    const doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    const result = JSON.parse(JSON.stringify(doc));
    const verificationToken = doc._verificationToken;
    // custom id type reset
    result.id = result._id;
    if (verificationToken) {
        result._verificationToken = verificationToken;
    }
    return result;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVHbG9iYWxWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlR2xvYmFsVmVyc2lvbkFyZ3MgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBQYXlsb2FkUmVxdWVzdCwgVHlwZVdpdGhJRCB9IGZyb20gJ3BheWxvYWQvdHlwZXMnXG5cbmltcG9ydCB0eXBlIHsgTW9uZ29vc2VBZGFwdGVyIH0gZnJvbSAnLidcblxuaW1wb3J0IHsgd2l0aFNlc3Npb24gfSBmcm9tICcuL3dpdGhTZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlR2xvYmFsVmVyc2lvbjxUIGV4dGVuZHMgVHlwZVdpdGhJRD4oXG4gIHRoaXM6IE1vbmdvb3NlQWRhcHRlcixcbiAgeyBnbG9iYWwsIGxvY2FsZSwgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QsIHZlcnNpb25EYXRhLCB3aGVyZSB9OiBVcGRhdGVHbG9iYWxWZXJzaW9uQXJnczxUPixcbikge1xuICBjb25zdCBWZXJzaW9uTW9kZWwgPSB0aGlzLnZlcnNpb25zW2dsb2JhbF1cbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAuLi53aXRoU2Vzc2lvbih0aGlzLCByZXEudHJhbnNhY3Rpb25JRCksXG4gICAgbGVhbjogdHJ1ZSxcbiAgICBuZXc6IHRydWUsXG4gIH1cblxuICBjb25zdCBxdWVyeSA9IGF3YWl0IFZlcnNpb25Nb2RlbC5idWlsZFF1ZXJ5KHtcbiAgICBsb2NhbGUsXG4gICAgcGF5bG9hZDogdGhpcy5wYXlsb2FkLFxuICAgIHdoZXJlLFxuICB9KVxuXG4gIGNvbnN0IGRvYyA9IGF3YWl0IFZlcnNpb25Nb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCB2ZXJzaW9uRGF0YSwgb3B0aW9ucylcblxuICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRvYykpXG5cbiAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBkb2MuX3ZlcmlmaWNhdGlvblRva2VuXG5cbiAgLy8gY3VzdG9tIGlkIHR5cGUgcmVzZXRcbiAgcmVzdWx0LmlkID0gcmVzdWx0Ll9pZFxuICBpZiAodmVyaWZpY2F0aW9uVG9rZW4pIHtcbiAgICByZXN1bHQuX3ZlcmlmaWNhdGlvblRva2VuID0gdmVyaWZpY2F0aW9uVG9rZW5cbiAgfVxuICByZXR1cm4gcmVzdWx0XG59XG4iXSwibmFtZXMiOlsidXBkYXRlR2xvYmFsVmVyc2lvbiIsImdsb2JhbCIsImxvY2FsZSIsInJlcSIsInZlcnNpb25EYXRhIiwid2hlcmUiLCJWZXJzaW9uTW9kZWwiLCJ2ZXJzaW9ucyIsIm9wdGlvbnMiLCJ3aXRoU2Vzc2lvbiIsInRyYW5zYWN0aW9uSUQiLCJsZWFuIiwibmV3IiwicXVlcnkiLCJidWlsZFF1ZXJ5IiwicGF5bG9hZCIsImRvYyIsImZpbmRPbmVBbmRVcGRhdGUiLCJyZXN1bHQiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ2ZXJpZmljYXRpb25Ub2tlbiIsIl92ZXJpZmljYXRpb25Ub2tlbiIsImlkIiwiX2lkIl0sIm1hcHBpbmdzIjoiOzs7OytCQU9zQkE7OztlQUFBQTs7OzZCQUZNO0FBRXJCLGVBQWVBLG9CQUVwQixFQUFFQyxNQUFNLEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxDQUFDLENBQW1CLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUE4QjtJQUU5RixNQUFNQyxlQUFlLElBQUksQ0FBQ0MsUUFBUSxDQUFDTixPQUFPO0lBQzFDLE1BQU1PLFVBQVU7UUFDZCxHQUFHQyxJQUFBQSx3QkFBVyxFQUFDLElBQUksRUFBRU4sSUFBSU8sYUFBYSxDQUFDO1FBQ3ZDQyxNQUFNO1FBQ05DLEtBQUs7SUFDUDtJQUVBLE1BQU1DLFFBQVEsTUFBTVAsYUFBYVEsVUFBVSxDQUFDO1FBQzFDWjtRQUNBYSxTQUFTLElBQUksQ0FBQ0EsT0FBTztRQUNyQlY7SUFDRjtJQUVBLE1BQU1XLE1BQU0sTUFBTVYsYUFBYVcsZ0JBQWdCLENBQUNKLE9BQU9ULGFBQWFJO0lBRXBFLE1BQU1VLFNBQVNDLEtBQUtDLEtBQUssQ0FBQ0QsS0FBS0UsU0FBUyxDQUFDTDtJQUV6QyxNQUFNTSxvQkFBb0JOLElBQUlPLGtCQUFrQjtJQUVoRCx1QkFBdUI7SUFDdkJMLE9BQU9NLEVBQUUsR0FBR04sT0FBT08sR0FBRztJQUN0QixJQUFJSCxtQkFBbUI7UUFDckJKLE9BQU9LLGtCQUFrQixHQUFHRDtJQUM5QjtJQUNBLE9BQU9KO0FBQ1QifQ==