"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "saveVersion", {
    enumerable: true,
    get: function() {
        return saveVersion;
    }
});
const _deepCopyObject = require("../utilities/deepCopyObject");
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("../utilities/sanitizeInternalFields"));
const _enforceMaxVersions = require("./enforceMaxVersions");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const saveVersion = async ({ id, autosave, collection, docWithLocales: doc, draft, global, payload, req })=>{
    let result;
    let createNewVersion = true;
    const now = new Date().toISOString();
    const versionData = (0, _deepCopyObject.deepCopyObject)(doc);
    if (draft) versionData._status = 'draft';
    if (versionData._id) delete versionData._id;
    try {
        if (autosave) {
            let docs;
            const findVersionArgs = {
                collectionSlug: collection.slug,
                globalSlug: collection.slug,
                limit: 1,
                req,
                sort: '-updatedAt',
                where: {
                    parent: {
                        equals: id
                    }
                }
            };
            if (collection) {
                ({ docs } = await payload.db.findVersions({
                    ...findVersionArgs,
                    collection: collection.slug,
                    req
                }));
            } else {
                ({ docs } = await payload.db.findGlobalVersions({
                    ...findVersionArgs,
                    global: global.slug,
                    req
                }));
            }
            const [latestVersion] = docs;
            // overwrite the latest version if it's set to autosave
            if (latestVersion?.autosave === true) {
                createNewVersion = false;
                const data = {
                    createdAt: new Date(latestVersion.createdAt).toISOString(),
                    updatedAt: draft ? now : new Date(doc.updatedAt).toISOString(),
                    version: versionData
                };
                const updateVersionArgs = {
                    id: latestVersion.id,
                    req,
                    versionData: data
                };
                if (collection) {
                    result = await payload.db.updateVersion({
                        ...updateVersionArgs,
                        collection: collection.slug,
                        req
                    });
                } else {
                    result = await payload.db.updateGlobalVersion({
                        ...updateVersionArgs,
                        global: global.slug,
                        req
                    });
                }
            }
        }
        if (createNewVersion) {
            if (collection) {
                result = await payload.db.createVersion({
                    autosave: Boolean(autosave),
                    collectionSlug: collection.slug,
                    createdAt: doc?.createdAt ? new Date(doc.createdAt).toISOString() : now,
                    parent: collection ? id : undefined,
                    req,
                    updatedAt: draft ? now : new Date(doc.updatedAt).toISOString(),
                    versionData
                });
            }
            if (global) {
                result = await payload.db.createGlobalVersion({
                    autosave: Boolean(autosave),
                    createdAt: doc?.createdAt ? new Date(doc.createdAt).toISOString() : now,
                    globalSlug: global.slug,
                    parent: collection ? id : undefined,
                    req,
                    updatedAt: draft ? now : new Date(doc.updatedAt).toISOString(),
                    versionData
                });
            }
        }
    } catch (err) {
        let errorMessage;
        if (collection) errorMessage = `There was an error while saving a version for the ${collection.labels.singular} with ID ${id}.`;
        if (global) errorMessage = `There was an error while saving a version for the global ${global.label}.`;
        payload.logger.error(errorMessage);
        payload.logger.error(err);
    }
    let max = 100;
    if (collection && typeof collection.versions.maxPerDoc === 'number') max = collection.versions.maxPerDoc;
    if (global && typeof global.versions.max === 'number') max = global.versions.max;
    if (createNewVersion && max > 0) {
        await (0, _enforceMaxVersions.enforceMaxVersions)({
            id,
            collection,
            global,
            max,
            payload,
            req
        });
    }
    let createdVersion = result.version;
    createdVersion.createdAt = result.createdAt;
    createdVersion.updatedAt = result.updatedAt;
    createdVersion = (0, _sanitizeInternalFields.default)(createdVersion);
    createdVersion.id = id;
    return createdVersion;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92ZXJzaW9ucy9zYXZlVmVyc2lvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFNhbml0aXplZENvbGxlY3Rpb25Db25maWcsIFR5cGVXaXRoSUQgfSBmcm9tICcuLi9jb2xsZWN0aW9ucy9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAnLi4vZXhwcmVzcy90eXBlcydcbmltcG9ydCB0eXBlIHsgU2FuaXRpemVkR2xvYmFsQ29uZmlnIH0gZnJvbSAnLi4vZ2xvYmFscy9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWQgfSBmcm9tICcuLi9wYXlsb2FkJ1xuXG5pbXBvcnQgeyBkZWVwQ29weU9iamVjdCB9IGZyb20gJy4uL3V0aWxpdGllcy9kZWVwQ29weU9iamVjdCdcbmltcG9ydCBzYW5pdGl6ZUludGVybmFsRmllbGRzIGZyb20gJy4uL3V0aWxpdGllcy9zYW5pdGl6ZUludGVybmFsRmllbGRzJ1xuaW1wb3J0IHsgZW5mb3JjZU1heFZlcnNpb25zIH0gZnJvbSAnLi9lbmZvcmNlTWF4VmVyc2lvbnMnXG5cbnR5cGUgQXJncyA9IHtcbiAgYXV0b3NhdmU/OiBib29sZWFuXG4gIGNvbGxlY3Rpb24/OiBTYW5pdGl6ZWRDb2xsZWN0aW9uQ29uZmlnXG4gIGRvY1dpdGhMb2NhbGVzOiBhbnlcbiAgZHJhZnQ/OiBib29sZWFuXG4gIGdsb2JhbD86IFNhbml0aXplZEdsb2JhbENvbmZpZ1xuICBpZD86IG51bWJlciB8IHN0cmluZ1xuICBwYXlsb2FkOiBQYXlsb2FkXG4gIHJlcT86IFBheWxvYWRSZXF1ZXN0XG59XG5cbmV4cG9ydCBjb25zdCBzYXZlVmVyc2lvbiA9IGFzeW5jICh7XG4gIGlkLFxuICBhdXRvc2F2ZSxcbiAgY29sbGVjdGlvbixcbiAgZG9jV2l0aExvY2FsZXM6IGRvYyxcbiAgZHJhZnQsXG4gIGdsb2JhbCxcbiAgcGF5bG9hZCxcbiAgcmVxLFxufTogQXJncyk6IFByb21pc2U8VHlwZVdpdGhJRD4gPT4ge1xuICBsZXQgcmVzdWx0XG4gIGxldCBjcmVhdGVOZXdWZXJzaW9uID0gdHJ1ZVxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgY29uc3QgdmVyc2lvbkRhdGEgPSBkZWVwQ29weU9iamVjdChkb2MpXG4gIGlmIChkcmFmdCkgdmVyc2lvbkRhdGEuX3N0YXR1cyA9ICdkcmFmdCdcbiAgaWYgKHZlcnNpb25EYXRhLl9pZCkgZGVsZXRlIHZlcnNpb25EYXRhLl9pZFxuXG4gIHRyeSB7XG4gICAgaWYgKGF1dG9zYXZlKSB7XG4gICAgICBsZXQgZG9jc1xuICAgICAgY29uc3QgZmluZFZlcnNpb25BcmdzID0ge1xuICAgICAgICBjb2xsZWN0aW9uU2x1ZzogY29sbGVjdGlvbi5zbHVnLFxuICAgICAgICBnbG9iYWxTbHVnOiBjb2xsZWN0aW9uLnNsdWcsXG4gICAgICAgIGxpbWl0OiAxLFxuICAgICAgICByZXEsXG4gICAgICAgIHNvcnQ6ICctdXBkYXRlZEF0JyxcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBwYXJlbnQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICAgIDsoeyBkb2NzIH0gPSBhd2FpdCBwYXlsb2FkLmRiLmZpbmRWZXJzaW9ucyh7XG4gICAgICAgICAgLi4uZmluZFZlcnNpb25BcmdzLFxuICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb24uc2x1ZyxcbiAgICAgICAgICByZXEsXG4gICAgICAgIH0pKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgOyh7IGRvY3MgfSA9IGF3YWl0IHBheWxvYWQuZGIuZmluZEdsb2JhbFZlcnNpb25zKHtcbiAgICAgICAgICAuLi5maW5kVmVyc2lvbkFyZ3MsXG4gICAgICAgICAgZ2xvYmFsOiBnbG9iYWwuc2x1ZyxcbiAgICAgICAgICByZXEsXG4gICAgICAgIH0pKVxuICAgICAgfVxuICAgICAgY29uc3QgW2xhdGVzdFZlcnNpb25dID0gZG9jc1xuXG4gICAgICAvLyBvdmVyd3JpdGUgdGhlIGxhdGVzdCB2ZXJzaW9uIGlmIGl0J3Mgc2V0IHRvIGF1dG9zYXZlXG4gICAgICBpZiAobGF0ZXN0VmVyc2lvbj8uYXV0b3NhdmUgPT09IHRydWUpIHtcbiAgICAgICAgY3JlYXRlTmV3VmVyc2lvbiA9IGZhbHNlXG5cbiAgICAgICAgY29uc3QgZGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7XG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShsYXRlc3RWZXJzaW9uLmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGRyYWZ0ID8gbm93IDogbmV3IERhdGUoZG9jLnVwZGF0ZWRBdCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uRGF0YSxcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVwZGF0ZVZlcnNpb25BcmdzID0ge1xuICAgICAgICAgIGlkOiBsYXRlc3RWZXJzaW9uLmlkLFxuICAgICAgICAgIHJlcSxcbiAgICAgICAgICB2ZXJzaW9uRGF0YTogZGF0YSBhcyBUeXBlV2l0aElELFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBwYXlsb2FkLmRiLnVwZGF0ZVZlcnNpb24oe1xuICAgICAgICAgICAgLi4udXBkYXRlVmVyc2lvbkFyZ3MsXG4gICAgICAgICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uLnNsdWcsXG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBwYXlsb2FkLmRiLnVwZGF0ZUdsb2JhbFZlcnNpb24oe1xuICAgICAgICAgICAgLi4udXBkYXRlVmVyc2lvbkFyZ3MsXG4gICAgICAgICAgICBnbG9iYWw6IGdsb2JhbC5zbHVnLFxuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY3JlYXRlTmV3VmVyc2lvbikge1xuICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgcGF5bG9hZC5kYi5jcmVhdGVWZXJzaW9uKHtcbiAgICAgICAgICBhdXRvc2F2ZTogQm9vbGVhbihhdXRvc2F2ZSksXG4gICAgICAgICAgY29sbGVjdGlvblNsdWc6IGNvbGxlY3Rpb24uc2x1ZyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGRvYz8uY3JlYXRlZEF0ID8gbmV3IERhdGUoZG9jLmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKSA6IG5vdyxcbiAgICAgICAgICBwYXJlbnQ6IGNvbGxlY3Rpb24gPyBpZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICByZXEsXG4gICAgICAgICAgdXBkYXRlZEF0OiBkcmFmdCA/IG5vdyA6IG5ldyBEYXRlKGRvYy51cGRhdGVkQXQpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgdmVyc2lvbkRhdGEsXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIGlmIChnbG9iYWwpIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgcGF5bG9hZC5kYi5jcmVhdGVHbG9iYWxWZXJzaW9uKHtcbiAgICAgICAgICBhdXRvc2F2ZTogQm9vbGVhbihhdXRvc2F2ZSksXG4gICAgICAgICAgY3JlYXRlZEF0OiBkb2M/LmNyZWF0ZWRBdCA/IG5ldyBEYXRlKGRvYy5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCkgOiBub3csXG4gICAgICAgICAgZ2xvYmFsU2x1ZzogZ2xvYmFsLnNsdWcsXG4gICAgICAgICAgcGFyZW50OiBjb2xsZWN0aW9uID8gaWQgOiB1bmRlZmluZWQsXG4gICAgICAgICAgcmVxLFxuICAgICAgICAgIHVwZGF0ZWRBdDogZHJhZnQgPyBub3cgOiBuZXcgRGF0ZShkb2MudXBkYXRlZEF0KS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHZlcnNpb25EYXRhLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IGVycm9yTWVzc2FnZTogc3RyaW5nXG5cbiAgICBpZiAoY29sbGVjdGlvbilcbiAgICAgIGVycm9yTWVzc2FnZSA9IGBUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgc2F2aW5nIGEgdmVyc2lvbiBmb3IgdGhlICR7Y29sbGVjdGlvbi5sYWJlbHMuc2luZ3VsYXJ9IHdpdGggSUQgJHtpZH0uYFxuICAgIGlmIChnbG9iYWwpXG4gICAgICBlcnJvck1lc3NhZ2UgPSBgVGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIHNhdmluZyBhIHZlcnNpb24gZm9yIHRoZSBnbG9iYWwgJHtnbG9iYWwubGFiZWx9LmBcbiAgICBwYXlsb2FkLmxvZ2dlci5lcnJvcihlcnJvck1lc3NhZ2UpXG4gICAgcGF5bG9hZC5sb2dnZXIuZXJyb3IoZXJyKVxuICB9XG5cbiAgbGV0IG1heCA9IDEwMFxuXG4gIGlmIChjb2xsZWN0aW9uICYmIHR5cGVvZiBjb2xsZWN0aW9uLnZlcnNpb25zLm1heFBlckRvYyA9PT0gJ251bWJlcicpXG4gICAgbWF4ID0gY29sbGVjdGlvbi52ZXJzaW9ucy5tYXhQZXJEb2NcbiAgaWYgKGdsb2JhbCAmJiB0eXBlb2YgZ2xvYmFsLnZlcnNpb25zLm1heCA9PT0gJ251bWJlcicpIG1heCA9IGdsb2JhbC52ZXJzaW9ucy5tYXhcblxuICBpZiAoY3JlYXRlTmV3VmVyc2lvbiAmJiBtYXggPiAwKSB7XG4gICAgYXdhaXQgZW5mb3JjZU1heFZlcnNpb25zKHtcbiAgICAgIGlkLFxuICAgICAgY29sbGVjdGlvbixcbiAgICAgIGdsb2JhbCxcbiAgICAgIG1heCxcbiAgICAgIHBheWxvYWQsXG4gICAgICByZXEsXG4gICAgfSlcbiAgfVxuXG4gIGxldCBjcmVhdGVkVmVyc2lvbiA9IHJlc3VsdC52ZXJzaW9uXG4gIGNyZWF0ZWRWZXJzaW9uLmNyZWF0ZWRBdCA9IHJlc3VsdC5jcmVhdGVkQXRcbiAgY3JlYXRlZFZlcnNpb24udXBkYXRlZEF0ID0gcmVzdWx0LnVwZGF0ZWRBdFxuXG4gIGNyZWF0ZWRWZXJzaW9uID0gc2FuaXRpemVJbnRlcm5hbEZpZWxkcyhjcmVhdGVkVmVyc2lvbilcbiAgY3JlYXRlZFZlcnNpb24uaWQgPSBpZFxuXG4gIHJldHVybiBjcmVhdGVkVmVyc2lvblxufVxuIl0sIm5hbWVzIjpbInNhdmVWZXJzaW9uIiwiaWQiLCJhdXRvc2F2ZSIsImNvbGxlY3Rpb24iLCJkb2NXaXRoTG9jYWxlcyIsImRvYyIsImRyYWZ0IiwiZ2xvYmFsIiwicGF5bG9hZCIsInJlcSIsInJlc3VsdCIsImNyZWF0ZU5ld1ZlcnNpb24iLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJ2ZXJzaW9uRGF0YSIsImRlZXBDb3B5T2JqZWN0IiwiX3N0YXR1cyIsIl9pZCIsImRvY3MiLCJmaW5kVmVyc2lvbkFyZ3MiLCJjb2xsZWN0aW9uU2x1ZyIsInNsdWciLCJnbG9iYWxTbHVnIiwibGltaXQiLCJzb3J0Iiwid2hlcmUiLCJwYXJlbnQiLCJlcXVhbHMiLCJkYiIsImZpbmRWZXJzaW9ucyIsImZpbmRHbG9iYWxWZXJzaW9ucyIsImxhdGVzdFZlcnNpb24iLCJkYXRhIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwidmVyc2lvbiIsInVwZGF0ZVZlcnNpb25BcmdzIiwidXBkYXRlVmVyc2lvbiIsInVwZGF0ZUdsb2JhbFZlcnNpb24iLCJjcmVhdGVWZXJzaW9uIiwiQm9vbGVhbiIsInVuZGVmaW5lZCIsImNyZWF0ZUdsb2JhbFZlcnNpb24iLCJlcnIiLCJlcnJvck1lc3NhZ2UiLCJsYWJlbHMiLCJzaW5ndWxhciIsImxhYmVsIiwibG9nZ2VyIiwiZXJyb3IiLCJtYXgiLCJ2ZXJzaW9ucyIsIm1heFBlckRvYyIsImVuZm9yY2VNYXhWZXJzaW9ucyIsImNyZWF0ZWRWZXJzaW9uIiwic2FuaXRpemVJbnRlcm5hbEZpZWxkcyJd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