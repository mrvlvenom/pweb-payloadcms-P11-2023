"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _qs = /*#__PURE__*/ _interop_require_default(require("qs"));
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _reactrouterdom = require("react-router-dom");
const _flattenTopLevelFields = /*#__PURE__*/ _interop_require_default(require("../../../../utilities/flattenTopLevelFields"));
const _getTranslation = require("../../../../utilities/getTranslation");
const _useThrottledEffect = /*#__PURE__*/ _interop_require_default(require("../../../hooks/useThrottledEffect"));
const _SearchParams = require("../../utilities/SearchParams");
const _Button = /*#__PURE__*/ _interop_require_default(require("../Button"));
const _Condition = /*#__PURE__*/ _interop_require_default(require("./Condition"));
const _fieldtypes = /*#__PURE__*/ _interop_require_default(require("./field-types"));
require("./index.scss");
const _reducer = /*#__PURE__*/ _interop_require_default(require("./reducer"));
const _transformWhereQuery = require("./transformWhereQuery");
const _validateWhereQuery = /*#__PURE__*/ _interop_require_default(require("./validateWhereQuery"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'where-builder';
const reduceFields = (fields, i18n)=>(0, _flattenTopLevelFields.default)(fields).reduce((reduced, field)=>{
        if (typeof _fieldtypes.default[field.type] === 'object') {
            const formattedField = {
                label: (0, _getTranslation.getTranslation)(field.label || field.name, i18n),
                value: field.name,
                ..._fieldtypes.default[field.type],
                operators: _fieldtypes.default[field.type].operators.map((operator)=>({
                        ...operator,
                        label: i18n.t(`operators:${operator.label}`)
                    })),
                props: {
                    ...field
                }
            };
            return [
                ...reduced,
                formattedField
            ];
        }
        return reduced;
    }, []);
/**
 * The WhereBuilder component is used to render the filter controls for a collection's list view.
 * It is part of the {@link ListControls} component which is used to render the controls (search, filter, where).
 */ const WhereBuilder = (props)=>{
    const { collection: { labels: { plural } = {} } = {}, collection, handleChange, modifySearchQuery = true } = props;
    const history = (0, _reactrouterdom.useHistory)();
    const params = (0, _SearchParams.useSearchParams)();
    const { i18n, t } = (0, _reacti18next.useTranslation)('general');
    // This handles initializing the where conditions from the search query (URL). That way, if you pass in
    // query params to the URL, the where conditions will be initialized from those and displayed in the UI.
    // Example: /admin/collections/posts?where[or][0][and][0][text][equals]=example%20post
    const [conditions, dispatchConditions] = (0, _react.useReducer)(_reducer.default, params.where, (whereFromSearch)=>{
        if (modifySearchQuery && whereFromSearch) {
            if ((0, _validateWhereQuery.default)(whereFromSearch)) {
                return whereFromSearch.or;
            }
            // Transform the where query to be in the right format. This will transform something simple like [text][equals]=example%20post to the right format
            const transformedWhere = (0, _transformWhereQuery.transformWhereQuery)(whereFromSearch);
            if ((0, _validateWhereQuery.default)(transformedWhere)) {
                return transformedWhere.or;
            }
            console.warn('Invalid where query in URL. Ignoring.');
        }
        return [];
    });
    const [reducedFields] = (0, _react.useState)(()=>reduceFields(collection.fields, i18n));
    // This handles updating the search query (URL) when the where conditions change
    (0, _useThrottledEffect.default)(()=>{
        const currentParams = _qs.default.parse(history.location.search, {
            depth: 10,
            ignoreQueryPrefix: true
        });
        const paramsToKeep = typeof currentParams?.where === 'object' && 'or' in currentParams.where ? currentParams.where.or.reduce((keptParams, param)=>{
            const newParam = {
                ...param
            };
            if (param.and) {
                delete newParam.and;
            }
            return [
                ...keptParams,
                newParam
            ];
        }, []) : [];
        const hasNewWhereConditions = conditions.length > 0;
        const newWhereQuery = {
            ...typeof currentParams?.where === 'object' && ((0, _validateWhereQuery.default)(currentParams?.where) || !hasNewWhereConditions) ? currentParams.where : {},
            or: [
                ...conditions,
                ...paramsToKeep
            ]
        };
        if (handleChange) handleChange(newWhereQuery);
        const hasExistingConditions = typeof currentParams?.where === 'object' && 'or' in currentParams.where;
        if (modifySearchQuery && (hasExistingConditions && !hasNewWhereConditions || hasNewWhereConditions)) {
            history.replace({
                search: _qs.default.stringify({
                    ...currentParams,
                    page: 1,
                    where: newWhereQuery
                }, {
                    addQueryPrefix: true
                })
            });
        }
    }, 500, [
        conditions,
        modifySearchQuery,
        handleChange
    ]);
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: baseClass
    }, conditions.length > 0 && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__label`
    }, t('filterWhere', {
        label: (0, _getTranslation.getTranslation)(plural, i18n)
    })), /*#__PURE__*/ _react.default.createElement("ul", {
        className: `${baseClass}__or-filters`
    }, conditions.map((or, orIndex)=>/*#__PURE__*/ _react.default.createElement("li", {
            key: orIndex
        }, orIndex !== 0 && /*#__PURE__*/ _react.default.createElement("div", {
            className: `${baseClass}__label`
        }, t('or')), /*#__PURE__*/ _react.default.createElement("ul", {
            className: `${baseClass}__and-filters`
        }, Array.isArray(or?.and) && or.and.map((_, andIndex)=>/*#__PURE__*/ _react.default.createElement("li", {
                key: andIndex
            }, andIndex !== 0 && /*#__PURE__*/ _react.default.createElement("div", {
                className: `${baseClass}__label`
            }, t('and')), /*#__PURE__*/ _react.default.createElement(_Condition.default, {
                andIndex: andIndex,
                dispatch: dispatchConditions,
                fields: reducedFields,
                key: andIndex,
                orIndex: orIndex,
                value: conditions[orIndex].and[andIndex]
            }))))))), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__add-or`,
        icon: "plus",
        iconPosition: "left",
        iconStyle: "with-border",
        onClick: ()=>{
            if (reducedFields.length > 0) dispatchConditions({
                field: reducedFields[0].value,
                type: 'add'
            });
        }
    }, t('or'))), conditions.length === 0 && /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__no-filters`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__label`
    }, t('noFiltersSet')), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__add-first-filter`,
        icon: "plus",
        iconPosition: "left",
        iconStyle: "with-border",
        onClick: ()=>{
            if (reducedFields.length > 0) dispatchConditions({
                field: reducedFields[0].value,
                type: 'add'
            });
        }
    }, t('addFilter'))));
};
const _default = WhereBuilder;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2VsZW1lbnRzL1doZXJlQnVpbGRlci9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHF1ZXJ5U3RyaW5nIGZyb20gJ3FzJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZVJlZHVjZXIsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSdcblxuaW1wb3J0IHR5cGUgeyBXaGVyZSB9IGZyb20gJy4uLy4uLy4uLy4uL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBQcm9wcyB9IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCBmbGF0dGVuVG9wTGV2ZWxGaWVsZHMgZnJvbSAnLi4vLi4vLi4vLi4vdXRpbGl0aWVzL2ZsYXR0ZW5Ub3BMZXZlbEZpZWxkcydcbmltcG9ydCB7IGdldFRyYW5zbGF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbGl0aWVzL2dldFRyYW5zbGF0aW9uJ1xuaW1wb3J0IHVzZVRocm90dGxlZEVmZmVjdCBmcm9tICcuLi8uLi8uLi9ob29rcy91c2VUaHJvdHRsZWRFZmZlY3QnXG5pbXBvcnQgeyB1c2VTZWFyY2hQYXJhbXMgfSBmcm9tICcuLi8uLi91dGlsaXRpZXMvU2VhcmNoUGFyYW1zJ1xuaW1wb3J0IEJ1dHRvbiBmcm9tICcuLi9CdXR0b24nXG5pbXBvcnQgQ29uZGl0aW9uIGZyb20gJy4vQ29uZGl0aW9uJ1xuaW1wb3J0IGZpZWxkVHlwZXMgZnJvbSAnLi9maWVsZC10eXBlcydcbmltcG9ydCAnLi9pbmRleC5zY3NzJ1xuaW1wb3J0IHJlZHVjZXIgZnJvbSAnLi9yZWR1Y2VyJ1xuaW1wb3J0IHsgdHJhbnNmb3JtV2hlcmVRdWVyeSB9IGZyb20gJy4vdHJhbnNmb3JtV2hlcmVRdWVyeSdcbmltcG9ydCB2YWxpZGF0ZVdoZXJlUXVlcnkgZnJvbSAnLi92YWxpZGF0ZVdoZXJlUXVlcnknXG5cbmNvbnN0IGJhc2VDbGFzcyA9ICd3aGVyZS1idWlsZGVyJ1xuXG5jb25zdCByZWR1Y2VGaWVsZHMgPSAoZmllbGRzLCBpMThuKSA9PlxuICBmbGF0dGVuVG9wTGV2ZWxGaWVsZHMoZmllbGRzKS5yZWR1Y2UoKHJlZHVjZWQsIGZpZWxkKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBmaWVsZFR5cGVzW2ZpZWxkLnR5cGVdID09PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgZm9ybWF0dGVkRmllbGQgPSB7XG4gICAgICAgIGxhYmVsOiBnZXRUcmFuc2xhdGlvbihmaWVsZC5sYWJlbCB8fCBmaWVsZC5uYW1lLCBpMThuKSxcbiAgICAgICAgdmFsdWU6IGZpZWxkLm5hbWUsXG4gICAgICAgIC4uLmZpZWxkVHlwZXNbZmllbGQudHlwZV0sXG4gICAgICAgIG9wZXJhdG9yczogZmllbGRUeXBlc1tmaWVsZC50eXBlXS5vcGVyYXRvcnMubWFwKChvcGVyYXRvcikgPT4gKHtcbiAgICAgICAgICAuLi5vcGVyYXRvcixcbiAgICAgICAgICBsYWJlbDogaTE4bi50KGBvcGVyYXRvcnM6JHtvcGVyYXRvci5sYWJlbH1gKSxcbiAgICAgICAgfSkpLFxuICAgICAgICBwcm9wczoge1xuICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICB9LFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gWy4uLnJlZHVjZWQsIGZvcm1hdHRlZEZpZWxkXVxuICAgIH1cblxuICAgIHJldHVybiByZWR1Y2VkXG4gIH0sIFtdKVxuXG4vKipcbiAqIFRoZSBXaGVyZUJ1aWxkZXIgY29tcG9uZW50IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBmaWx0ZXIgY29udHJvbHMgZm9yIGEgY29sbGVjdGlvbidzIGxpc3Qgdmlldy5cbiAqIEl0IGlzIHBhcnQgb2YgdGhlIHtAbGluayBMaXN0Q29udHJvbHN9IGNvbXBvbmVudCB3aGljaCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgY29udHJvbHMgKHNlYXJjaCwgZmlsdGVyLCB3aGVyZSkuXG4gKi9cbmNvbnN0IFdoZXJlQnVpbGRlcjogUmVhY3QuRkM8UHJvcHM+ID0gKHByb3BzKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBjb2xsZWN0aW9uOiB7IGxhYmVsczogeyBwbHVyYWwgfSA9IHt9IH0gPSB7fSxcbiAgICBjb2xsZWN0aW9uLFxuICAgIGhhbmRsZUNoYW5nZSxcbiAgICBtb2RpZnlTZWFyY2hRdWVyeSA9IHRydWUsXG4gIH0gPSBwcm9wc1xuXG4gIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5KClcbiAgY29uc3QgcGFyYW1zID0gdXNlU2VhcmNoUGFyYW1zKClcbiAgY29uc3QgeyBpMThuLCB0IH0gPSB1c2VUcmFuc2xhdGlvbignZ2VuZXJhbCcpXG5cbiAgLy8gVGhpcyBoYW5kbGVzIGluaXRpYWxpemluZyB0aGUgd2hlcmUgY29uZGl0aW9ucyBmcm9tIHRoZSBzZWFyY2ggcXVlcnkgKFVSTCkuIFRoYXQgd2F5LCBpZiB5b3UgcGFzcyBpblxuICAvLyBxdWVyeSBwYXJhbXMgdG8gdGhlIFVSTCwgdGhlIHdoZXJlIGNvbmRpdGlvbnMgd2lsbCBiZSBpbml0aWFsaXplZCBmcm9tIHRob3NlIGFuZCBkaXNwbGF5ZWQgaW4gdGhlIFVJLlxuICAvLyBFeGFtcGxlOiAvYWRtaW4vY29sbGVjdGlvbnMvcG9zdHM/d2hlcmVbb3JdWzBdW2FuZF1bMF1bdGV4dF1bZXF1YWxzXT1leGFtcGxlJTIwcG9zdFxuICBjb25zdCBbY29uZGl0aW9ucywgZGlzcGF0Y2hDb25kaXRpb25zXSA9IHVzZVJlZHVjZXIocmVkdWNlciwgcGFyYW1zLndoZXJlLCAod2hlcmVGcm9tU2VhcmNoKSA9PiB7XG4gICAgaWYgKG1vZGlmeVNlYXJjaFF1ZXJ5ICYmIHdoZXJlRnJvbVNlYXJjaCkge1xuICAgICAgaWYgKHZhbGlkYXRlV2hlcmVRdWVyeSh3aGVyZUZyb21TZWFyY2gpKSB7XG4gICAgICAgIHJldHVybiB3aGVyZUZyb21TZWFyY2gub3JcbiAgICAgIH1cblxuICAgICAgLy8gVHJhbnNmb3JtIHRoZSB3aGVyZSBxdWVyeSB0byBiZSBpbiB0aGUgcmlnaHQgZm9ybWF0LiBUaGlzIHdpbGwgdHJhbnNmb3JtIHNvbWV0aGluZyBzaW1wbGUgbGlrZSBbdGV4dF1bZXF1YWxzXT1leGFtcGxlJTIwcG9zdCB0byB0aGUgcmlnaHQgZm9ybWF0XG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZFdoZXJlID0gdHJhbnNmb3JtV2hlcmVRdWVyeSh3aGVyZUZyb21TZWFyY2gpXG5cbiAgICAgIGlmICh2YWxpZGF0ZVdoZXJlUXVlcnkodHJhbnNmb3JtZWRXaGVyZSkpIHtcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkV2hlcmUub3JcbiAgICAgIH1cblxuICAgICAgY29uc29sZS53YXJuKCdJbnZhbGlkIHdoZXJlIHF1ZXJ5IGluIFVSTC4gSWdub3JpbmcuJylcbiAgICB9XG4gICAgcmV0dXJuIFtdXG4gIH0pXG5cbiAgY29uc3QgW3JlZHVjZWRGaWVsZHNdID0gdXNlU3RhdGUoKCkgPT4gcmVkdWNlRmllbGRzKGNvbGxlY3Rpb24uZmllbGRzLCBpMThuKSlcblxuICAvLyBUaGlzIGhhbmRsZXMgdXBkYXRpbmcgdGhlIHNlYXJjaCBxdWVyeSAoVVJMKSB3aGVuIHRoZSB3aGVyZSBjb25kaXRpb25zIGNoYW5nZVxuICB1c2VUaHJvdHRsZWRFZmZlY3QoXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFBhcmFtcyA9IHF1ZXJ5U3RyaW5nLnBhcnNlKGhpc3RvcnkubG9jYXRpb24uc2VhcmNoLCB7XG4gICAgICAgIGRlcHRoOiAxMCxcbiAgICAgICAgaWdub3JlUXVlcnlQcmVmaXg6IHRydWUsXG4gICAgICB9KSBhcyB7IHdoZXJlOiBXaGVyZSB9XG5cbiAgICAgIGNvbnN0IHBhcmFtc1RvS2VlcCA9XG4gICAgICAgIHR5cGVvZiBjdXJyZW50UGFyYW1zPy53aGVyZSA9PT0gJ29iamVjdCcgJiYgJ29yJyBpbiBjdXJyZW50UGFyYW1zLndoZXJlXG4gICAgICAgICAgPyBjdXJyZW50UGFyYW1zLndoZXJlLm9yLnJlZHVjZSgoa2VwdFBhcmFtcywgcGFyYW0pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgbmV3UGFyYW0gPSB7IC4uLnBhcmFtIH1cbiAgICAgICAgICAgICAgaWYgKHBhcmFtLmFuZCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdQYXJhbS5hbmRcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gWy4uLmtlcHRQYXJhbXMsIG5ld1BhcmFtXVxuICAgICAgICAgICAgfSwgW10pXG4gICAgICAgICAgOiBbXVxuXG4gICAgICBjb25zdCBoYXNOZXdXaGVyZUNvbmRpdGlvbnMgPSBjb25kaXRpb25zLmxlbmd0aCA+IDBcblxuICAgICAgY29uc3QgbmV3V2hlcmVRdWVyeSA9IHtcbiAgICAgICAgLi4uKHR5cGVvZiBjdXJyZW50UGFyYW1zPy53aGVyZSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgKHZhbGlkYXRlV2hlcmVRdWVyeShjdXJyZW50UGFyYW1zPy53aGVyZSkgfHwgIWhhc05ld1doZXJlQ29uZGl0aW9ucylcbiAgICAgICAgICA/IGN1cnJlbnRQYXJhbXMud2hlcmVcbiAgICAgICAgICA6IHt9KSxcbiAgICAgICAgb3I6IFsuLi5jb25kaXRpb25zLCAuLi5wYXJhbXNUb0tlZXBdLFxuICAgICAgfVxuXG4gICAgICBpZiAoaGFuZGxlQ2hhbmdlKSBoYW5kbGVDaGFuZ2UobmV3V2hlcmVRdWVyeSBhcyBXaGVyZSlcblxuICAgICAgY29uc3QgaGFzRXhpc3RpbmdDb25kaXRpb25zID1cbiAgICAgICAgdHlwZW9mIGN1cnJlbnRQYXJhbXM/LndoZXJlID09PSAnb2JqZWN0JyAmJiAnb3InIGluIGN1cnJlbnRQYXJhbXMud2hlcmVcblxuICAgICAgaWYgKFxuICAgICAgICBtb2RpZnlTZWFyY2hRdWVyeSAmJlxuICAgICAgICAoKGhhc0V4aXN0aW5nQ29uZGl0aW9ucyAmJiAhaGFzTmV3V2hlcmVDb25kaXRpb25zKSB8fCBoYXNOZXdXaGVyZUNvbmRpdGlvbnMpXG4gICAgICApIHtcbiAgICAgICAgaGlzdG9yeS5yZXBsYWNlKHtcbiAgICAgICAgICBzZWFyY2g6IHF1ZXJ5U3RyaW5nLnN0cmluZ2lmeShcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4uY3VycmVudFBhcmFtcyxcbiAgICAgICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICAgICAgd2hlcmU6IG5ld1doZXJlUXVlcnksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBhZGRRdWVyeVByZWZpeDogdHJ1ZSB9LFxuICAgICAgICAgICksXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICA1MDAsXG4gICAgW2NvbmRpdGlvbnMsIG1vZGlmeVNlYXJjaFF1ZXJ5LCBoYW5kbGVDaGFuZ2VdLFxuICApXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17YmFzZUNsYXNzfT5cbiAgICAgIHtjb25kaXRpb25zLmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2xhYmVsYH0+XG4gICAgICAgICAgICB7dCgnZmlsdGVyV2hlcmUnLCB7IGxhYmVsOiBnZXRUcmFuc2xhdGlvbihwbHVyYWwsIGkxOG4pIH0pfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDx1bCBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX29yLWZpbHRlcnNgfT5cbiAgICAgICAgICAgIHtjb25kaXRpb25zLm1hcCgob3IsIG9ySW5kZXgpID0+IChcbiAgICAgICAgICAgICAgPGxpIGtleT17b3JJbmRleH0+XG4gICAgICAgICAgICAgICAge29ySW5kZXggIT09IDAgJiYgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2xhYmVsYH0+e3QoJ29yJyl9PC9kaXY+fVxuICAgICAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2FuZC1maWx0ZXJzYH0+XG4gICAgICAgICAgICAgICAgICB7QXJyYXkuaXNBcnJheShvcj8uYW5kKSAmJlxuICAgICAgICAgICAgICAgICAgICBvci5hbmQubWFwKChfLCBhbmRJbmRleCkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgIDxsaSBrZXk9e2FuZEluZGV4fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHthbmRJbmRleCAhPT0gMCAmJiA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fbGFiZWxgfT57dCgnYW5kJyl9PC9kaXY+fVxuICAgICAgICAgICAgICAgICAgICAgICAgPENvbmRpdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICBhbmRJbmRleD17YW5kSW5kZXh9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoPXtkaXNwYXRjaENvbmRpdGlvbnN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcz17cmVkdWNlZEZpZWxkc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXthbmRJbmRleH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3JJbmRleD17b3JJbmRleH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2NvbmRpdGlvbnNbb3JJbmRleF0uYW5kW2FuZEluZGV4XX1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fYWRkLW9yYH1cbiAgICAgICAgICAgIGljb249XCJwbHVzXCJcbiAgICAgICAgICAgIGljb25Qb3NpdGlvbj1cImxlZnRcIlxuICAgICAgICAgICAgaWNvblN0eWxlPVwid2l0aC1ib3JkZXJcIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICBpZiAocmVkdWNlZEZpZWxkcy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIGRpc3BhdGNoQ29uZGl0aW9ucyh7IGZpZWxkOiByZWR1Y2VkRmllbGRzWzBdLnZhbHVlLCB0eXBlOiAnYWRkJyB9KVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7dCgnb3InKX1cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICAgICl9XG4gICAgICB7Y29uZGl0aW9ucy5sZW5ndGggPT09IDAgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fbm8tZmlsdGVyc2B9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19sYWJlbGB9Pnt0KCdub0ZpbHRlcnNTZXQnKX08L2Rpdj5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICBidXR0b25TdHlsZT1cImljb24tbGFiZWxcIlxuICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19hZGQtZmlyc3QtZmlsdGVyYH1cbiAgICAgICAgICAgIGljb249XCJwbHVzXCJcbiAgICAgICAgICAgIGljb25Qb3NpdGlvbj1cImxlZnRcIlxuICAgICAgICAgICAgaWNvblN0eWxlPVwid2l0aC1ib3JkZXJcIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICBpZiAocmVkdWNlZEZpZWxkcy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIGRpc3BhdGNoQ29uZGl0aW9ucyh7IGZpZWxkOiByZWR1Y2VkRmllbGRzWzBdLnZhbHVlLCB0eXBlOiAnYWRkJyB9KVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7dCgnYWRkRmlsdGVyJyl9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBXaGVyZUJ1aWxkZXJcbiJdLCJuYW1lcyI6WyJiYXNlQ2xhc3MiLCJyZWR1Y2VGaWVsZHMiLCJmaWVsZHMiLCJpMThuIiwiZmxhdHRlblRvcExldmVsRmllbGRzIiwicmVkdWNlIiwicmVkdWNlZCIsImZpZWxkIiwiZmllbGRUeXBlcyIsInR5cGUiLCJmb3JtYXR0ZWRGaWVsZCIsImxhYmVsIiwiZ2V0VHJhbnNsYXRpb24iLCJuYW1lIiwidmFsdWUiLCJvcGVyYXRvcnMiLCJtYXAiLCJvcGVyYXRvciIsInQiLCJwcm9wcyIsIldoZXJlQnVpbGRlciIsImNvbGxlY3Rpb24iLCJsYWJlbHMiLCJwbHVyYWwiLCJoYW5kbGVDaGFuZ2UiLCJtb2RpZnlTZWFyY2hRdWVyeSIsImhpc3RvcnkiLCJ1c2VIaXN0b3J5IiwicGFyYW1zIiwidXNlU2VhcmNoUGFyYW1zIiwidXNlVHJhbnNsYXRpb24iLCJjb25kaXRpb25zIiwiZGlzcGF0Y2hDb25kaXRpb25zIiwidXNlUmVkdWNlciIsInJlZHVjZXIiLCJ3aGVyZSIsIndoZXJlRnJvbVNlYXJjaCIsInZhbGlkYXRlV2hlcmVRdWVyeSIsIm9yIiwidHJhbnNmb3JtZWRXaGVyZSIsInRyYW5zZm9ybVdoZXJlUXVlcnkiLCJjb25zb2xlIiwid2FybiIsInJlZHVjZWRGaWVsZHMiLCJ1c2VTdGF0ZSIsInVzZVRocm90dGxlZEVmZmVjdCIsImN1cnJlbnRQYXJhbXMiLCJxdWVyeVN0cmluZyIsInBhcnNlIiwibG9jYXRpb24iLCJzZWFyY2giLCJkZXB0aCIsImlnbm9yZVF1ZXJ5UHJlZml4IiwicGFyYW1zVG9LZWVwIiwia2VwdFBhcmFtcyIsInBhcmFtIiwibmV3UGFyYW0iLCJhbmQiLCJoYXNOZXdXaGVyZUNvbmRpdGlvbnMiLCJsZW5ndGgiLCJuZXdXaGVyZVF1ZXJ5IiwiaGFzRXhpc3RpbmdDb25kaXRpb25zIiwicmVwbGFjZSIsInN0cmluZ2lmeSIsInBhZ2UiLCJhZGRRdWVyeVByZWZpeCIsImRpdiIsImNsYXNzTmFtZSIsIlJlYWN0IiwiRnJhZ21lbnQiLCJ1bCIsIm9ySW5kZXgiLCJsaSIsImtleSIsIkFycmF5IiwiaXNBcnJheSIsIl8iLCJhbmRJbmRleCIsIkNvbmRpdGlvbiIsImRpc3BhdGNoIiwiQnV0dG9uIiwiYnV0dG9uU3R5bGUiLCJpY29uIiwiaWNvblBvc2l0aW9uIiwiaWNvblN0eWxlIiwib25DbGljayJdLCJtYXBwaW5ncyI6Ijs7OzsrQkE0TUE7OztlQUFBOzs7MkRBNU13QjsrREFDb0I7OEJBQ2I7Z0NBQ0o7OEVBS087Z0NBQ0g7MkVBQ0E7OEJBQ0M7K0RBQ2I7a0VBQ0c7bUVBQ0M7UUFDaEI7Z0VBQ2E7cUNBQ2dCOzJFQUNMOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFL0IsTUFBTUEsWUFBWTtBQUVsQixNQUFNQyxlQUFlLENBQUNDLFFBQVFDLE9BQzVCQyxJQUFBQSw4QkFBcUIsRUFBQ0YsUUFBUUcsTUFBTSxDQUFDLENBQUNDLFNBQVNDO1FBQzdDLElBQUksT0FBT0MsbUJBQVUsQ0FBQ0QsTUFBTUUsSUFBSSxDQUFDLEtBQUssVUFBVTtZQUM5QyxNQUFNQyxpQkFBaUI7Z0JBQ3JCQyxPQUFPQyxJQUFBQSw4QkFBYyxFQUFDTCxNQUFNSSxLQUFLLElBQUlKLE1BQU1NLElBQUksRUFBRVY7Z0JBQ2pEVyxPQUFPUCxNQUFNTSxJQUFJO2dCQUNqQixHQUFHTCxtQkFBVSxDQUFDRCxNQUFNRSxJQUFJLENBQUM7Z0JBQ3pCTSxXQUFXUCxtQkFBVSxDQUFDRCxNQUFNRSxJQUFJLENBQUMsQ0FBQ00sU0FBUyxDQUFDQyxHQUFHLENBQUMsQ0FBQ0MsV0FBYyxDQUFBO3dCQUM3RCxHQUFHQSxRQUFRO3dCQUNYTixPQUFPUixLQUFLZSxDQUFDLENBQUMsQ0FBQyxVQUFVLEVB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